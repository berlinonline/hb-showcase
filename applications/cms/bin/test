#!/usr/bin/env sh

readonly CURRENT_DIR=$(readlink -m $(dirname $0))

if [ -z "$APPLICATION_DIR" ] ; then
    APPLICATION_DIR=$(readlink -m "${CURRENT_DIR}/../")
fi

if [ -z "$HONEYBEE_DIR" ] ; then
    HONEYBEE_DIR=$(readlink -m "${APPLICATION_DIR}/vendor/berlinonline/honeybee")
fi

if [ -z "$HONEYBEE_BIN_TEST" ] ; then
    HONEYBEE_BIN_TEST=$(readlink -m "${HONEYBEE_DIR}/bin/test")
fi

if [ -f $HONEYBEE_BIN_TEST ] ; then
    echo "[INFO] Found honeybee bin/test."
else
    echo "[ERROR] Honeybee bin/test script not found: ${HONEYBEE_BIN_TEST}"
    echo "[ERROR] Make sure you have run 'make install' to get vendor libs and"
    echo "[ERROR] no environment variables are changing the bin/test behaviour."
    exit 1
fi

# You can set other (environment) variables to change defaults paths etc.:
#
# LOCAL_CONFIG_SH
# PHP_COMMAND
# TESTS_PHP_FILE
# TESTS_PHP_INI_SETTINGS
# TESTS_BOOTSTRAP_PHP_FILE
#
if [ -z "$TESTS_PHP_FILE" ] ; then
    TESTS_PHP_FILE=$(readlink -m "${HONEYBEE_DIR}/testing/run-tests.php")
fi

echo "[INFO] Sourcing: ${HONEYBEE_BIN_TEST}"

# including original honeybee bin/test script
. ${HONEYBEE_BIN_TEST}

