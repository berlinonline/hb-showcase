#!/bin/sh

LOCAL_CONFIG_SH=`dirname $0`/../etc/local/config.sh

if [ -f $LOCAL_CONFIG_SH ] ; then
    echo "[INFO] Sourcing local config file: $LOCAL_CONFIG_SH"
    . $LOCAL_CONFIG_SH
else
    echo "[ERROR] Couldn't source local config: $LOCAL_CONFIG_SH"
    echo "[ERROR] Make sure to run 'make configure' or 'make reconfigure'."
    exit 1
fi

if [ -z "$PHP_COMMAND" ] ; then
    echo "[ERROR] Unable to find a valid php executable."
    echo "[ERROR] Make sure to run 'make configure' or 'make reconfigure'."
    exit 1
fi

if [ -z "$AGAVI_ENVIRONMENT" ] ; then
    echo "[ERROR] AGAVI_ENVIRONMENT is not set."
    echo "[ERROR] Make sure to run 'make configure' or 'make reconfigure'."
    exit 1
fi

echo "[INFO] Executing: `which rlwrap` $AGAVI_ENVIRONMENT $PHP_COMMAND -d html_errors=off -f `dirname $0`/cli.php $@"
PHP_COMMAND=$PHP_COMMAND AGAVI_ENVIRONMENT=$AGAVI_ENVIRONMENT $PHP_COMMAND -d html_errors=off -f "`dirname $0`/cli.php" -- "$@"
